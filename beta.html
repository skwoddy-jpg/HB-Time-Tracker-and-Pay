<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HB Clock In Pro</title>
    <style>
        :root {
            --glass: rgba(255, 255, 255, 0.1);
            --glass-thick: rgba(255, 255, 255, 0.18);
            --glass-stroke: rgba(255, 255, 255, 0.2);
            --accent: #818cf8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-main: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.6);
            --bg-mesh: radial-gradient(at 0% 0%, #1e1b4b 0px, transparent 50%),
                        radial-gradient(at 100% 100%, #4338ca 0px, transparent 50%), #0f172a;
        }

        body.light-mode {
            --glass: rgba(255, 255, 255, 0.7);
            --glass-thick: rgba(255, 255, 255, 0.85);
            --glass-stroke: rgba(0, 0, 0, 0.1);
            --accent: #4f46e5;
            --text-main: #1e293b;
            --text-dim: #64748b;
            --bg-mesh: radial-gradient(at 0% 0%, #f1f5f9 0px, transparent 50%),
                        radial-gradient(at 100% 100%, #e0e7ff 0px, transparent 50%), #f8fafc;
        }

        body {
            margin: 0; padding: 10px; font-family: -apple-system, sans-serif;
            color: var(--text-main); background: var(--bg-mesh);
            background-attachment: fixed; min-height: 100vh; display: flex; flex-direction: column; align-items: center;
            transition: background 0.5s ease, color 0.3s ease;
        }

        .top-nav { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; box-sizing: border-box; }
        .nav-btn { background: var(--glass); border: 1px solid var(--glass-stroke); border-radius: 12px; color: var(--text-main); padding: 8px 12px; cursor: pointer; backdrop-filter: blur(10px); font-size: 0.8rem; font-weight: 700; }

        .bento-container { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; width: 100%; max-width: 500px; }
        .glass-card { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid var(--glass-stroke); border-radius: 30px; padding: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .full-width { grid-column: span 2; }

        @keyframes pulseAlert { 0%, 100% { color: var(--warning); text-shadow: 0 0 10px var(--warning); } 50% { color: var(--danger); text-shadow: 0 0 25px var(--danger); } }
        .status-pill { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 0.7rem; font-weight: 900; letter-spacing: 1.5px; margin-bottom: 15px; color: white; }
        .timer-label { font-size: 0.7rem; opacity: 0.7; text-transform: uppercase; font-weight: 800; color: var(--text-dim); text-align: center; display: block; }
        .timer-val { font-size: 3.5rem; font-weight: 800; margin: 10px 0; font-family: monospace; letter-spacing: -2px; text-align: center; }
        .break-timer { font-size: 1.8rem; font-weight: 800; animation: pulseAlert 2s infinite ease-in-out; text-align: center; margin-top: 5px; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        button { padding: 18px; border: none; border-radius: 20px; font-weight: 800; cursor: pointer; color: #fff; text-transform: uppercase; font-size: 0.85rem; }
        .btn-in { background: var(--success); grid-column: span 2; }
        .btn-pause { background: var(--warning); }
        .btn-out { background: var(--danger); }

        input { background: var(--glass); border: 1px solid var(--glass-stroke); color: var(--text-main); border-radius: 12px; padding: 12px; width: 100%; box-sizing: border-box; font-size: 0.95rem; margin-top: 6px; font-weight: 600; text-align: center; }

        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; width: 100%; }
        .config-item { display: flex; flex-direction: column; align-items: center; }
        
        .quick-edit-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 15px; width: 100%; }
        .quick-edit-col { display: flex; flex-direction: column; align-items: center; }

        .log-item { background: var(--glass); padding: 18px; border-radius: 24px; margin-top: 12px; border: 1px solid var(--glass-stroke); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(15px); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; box-sizing: border-box; }
        .modal { background: var(--glass-thick); border: 1px solid var(--glass-stroke); border-radius: 32px; width: 100%; max-width: 450px; padding: 30px; color: var(--text-main); }
        .version-tag { font-size: 0.6rem; opacity: 0.3; text-align: center; margin-top: 40px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="top-nav">
    <h1 style="font-size: 1.1rem; font-weight: 900; margin: 0;">HB PRO</h1>
    <div style="display: flex; gap: 8px;">
        <button class="nav-btn" onclick="toggleTheme()">THEME</button>
        <button class="nav-btn" onclick="openModal()">HELP</button>
    </div>
</div>

<div class="bento-container">
    <div class="glass-card full-width">
        <div id="statusPill" class="status-pill" style="background: rgba(255,255,255,0.1);">STANDBY</div>
        <div class="timer-label">Session Duration</div>
        <div id="display" class="timer-val">00:00:00</div>
        
        <div id="breakCont" style="display:none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--glass-stroke);">
            <div class="timer-label">Break Elapsed</div>
            <div id="breakDisplay" class="break-timer">00:00:00</div>
        </div>

        <div class="controls">
            <button id="startBtn" class="btn-in" onclick="startClock()">Clock In</button>
            <button id="breakBtn" class="btn-pause" onclick="toggleBreak()" style="display:none;">Break</button>
            <button id="stopBtn" class="btn-out" onclick="stopClock()" style="display:none;">Out</button>
        </div>
    </div>

    <div id="quickEdit" class="glass-card full-width" style="display:none;">
        <div class="timer-label" style="color:var(--accent);">Adjust Last Entry</div>
        <div class="quick-edit-grid">
            <div class="quick-edit-col"><label class="timer-label" style="font-size:0.55rem">Start</label><input type="time" id="eStart" onchange="editLast()"></div>
            <div class="quick-edit-col"><label class="timer-label" style="font-size:0.55rem">End</label><input type="time" id="eEnd" onchange="editLast()"></div>
            <div class="quick-edit-col"><label class="timer-label" style="font-size:0.55rem">Break</label><input type="number" id="eBreak" onchange="editLast()"></div>
        </div>
    </div>

    <div class="glass-card"><div class="timer-label">Period Pay</div><div id="payVal" style="font-size:1.6rem; font-weight:800; color:var(--success); text-align: center;">£0.00</div></div>
    <div class="glass-card"><div class="timer-label">Net Hours</div><div id="hrVal" style="font-size:1.6rem; font-weight:800; text-align: center;">0.00</div></div>

    <div class="glass-card full-width">
        <div class="config-grid">
            <div class="config-item"><label class="timer-label">Rate (£)</label><input type="number" id="rate" value="12.00" onchange="saveCfg()"></div>
            <div class="config-item"><label class="timer-label">Name</label><input type="text" id="pName" placeholder="Jan" onchange="saveCfg()"></div>
        </div>
        <div class="config-grid" style="margin-top: 15px;">
            <div class="config-item"><label class="timer-label">From</label><input type="date" id="sDate" onchange="saveCfg()"></div>
            <div class="config-item"><label class="timer-label">To</label><input type="date" id="eDate" onchange="saveCfg()"></div>
        </div>
        <button onclick="exportMail()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); margin-top: 20px; width: 100%;">Email Timesheet</button>
    </div>

    <div id="logList" class="full-width"></div>
    <div class="version-tag">HB Clock In — v1.9 Pro</div>
</div>

<div class="overlay" id="helpModal" onclick="closeModal()">
    <div class="modal" onclick="event.stopPropagation()">
        <h2 style="font-weight: 900; margin-top: 0;">HB Pro Help</h2>
        <p style="font-size: 0.9rem; opacity: 0.7; line-height: 1.6;">Your data is saved locally. If you open this app in multiple tabs, they will now sync automatically. Your timer will also survive if you close the tab or restart your phone.</p>
        <button onclick="closeModal()" style="background: var(--glass-stroke); color: var(--text-main); width: 100%; margin-top: 15px;">Close</button>
    </div>
</div>

<script>
    let timerInt, breakInt;
    let shifts = JSON.parse(localStorage.getItem('hb_sh_v19')) || [];
    let cfg = JSON.parse(localStorage.getItem('hb_cf_v19')) || { rate: "12.00", s: new Date().toISOString().split('T')[0], e: new Date().toISOString().split('T')[0], theme: 'dark', pName: '' };
    let session = JSON.parse(localStorage.getItem('hb_session_v19')) || null;

    // Listen for changes in other tabs
    window.addEventListener('storage', (e) => {
        if (e.key === 'hb_session_v19' || e.key === 'hb_sh_v19') location.reload();
    });

    function init() {
        document.getElementById('rate').value = cfg.rate;
        document.getElementById('pName').value = cfg.pName;
        document.getElementById('sDate').value = cfg.s;
        document.getElementById('eDate').value = cfg.e;
        if (cfg.theme === 'light') document.body.classList.add('light-mode');
        if (session) recover();
        updateView();
    }

    function saveCfg() {
        cfg.rate = document.getElementById('rate').value;
        cfg.pName = document.getElementById('pName').value;
        cfg.s = document.getElementById('sDate').value;
        cfg.e = document.getElementById('eDate').value;
        localStorage.setItem('hb_cf_v19', JSON.stringify(cfg));
        updateView();
    }

    function startClock() {
        session = { start: Date.now(), pausedMs: 0, isPaused: false, pauseStart: null };
        localStorage.setItem('hb_session_v19', JSON.stringify(session));
        timerInt = setInterval(tick, 1000);
        updateUI(true);
    }

    function toggleBreak() {
        const now = Date.now();
        if (!session.isPaused) {
            session.pauseStart = now; session.isPaused = true;
            clearInterval(timerInt); breakInt = setInterval(tickBreak, 1000);
        } else {
            session.pausedMs += (now - session.pauseStart);
            session.isPaused = false; session.pauseStart = null;
            clearInterval(breakInt); timerInt = setInterval(tick, 1000);
        }
        localStorage.setItem('hb_session_v19', JSON.stringify(session));
        updateUI(true);
    }

    function stopClock() {
        if (!confirm("End shift?")) return;
        const now = Date.now();
        let b = session.pausedMs + (session.isPaused ? (now - session.pauseStart) : 0);
        shifts.unshift({ st: new Date(session.start).toISOString(), en: new Date(now).toISOString(), br: b });
        localStorage.setItem('hb_sh_v19', JSON.stringify(shifts));
        session = null; localStorage.removeItem('hb_session_v19');
        clearInterval(timerInt); clearInterval(breakInt);
        updateUI(false); updateView();
    }

    function recover() {
        updateUI(true);
        if (session.isPaused) {
            breakInt = setInterval(tickBreak, 1000);
            tick(); // Static update for main
        } else {
            timerInt = setInterval(tick, 1000);
        }
    }

    function tick() {
        let d = (session.isPaused ? session.pauseStart : Date.now()) - session.start - session.pausedMs;
        document.getElementById('display').innerText = fmt(d);
    }

    function tickBreak() {
        document.getElementById('breakDisplay').innerText = fmt(Date.now() - session.pauseStart);
    }

    function fmt(ms) {
        let s = Math.max(0, ms), h = Math.floor(s/3600000), m = Math.floor((s%3600000)/60000), sec = Math.floor((s%60000)/1000);
        return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
    }

    function updateUI(active) {
        document.getElementById('startBtn').style.display = active ? 'none' : 'block';
        document.getElementById('breakBtn').style.display = active ? 'block' : 'none';
        document.getElementById('stopBtn').style.display = active ? 'block' : 'none';
        document.getElementById('breakCont').style.display = (active && session.isPaused) ? 'block' : 'none';
        document.getElementById('breakBtn').innerText = (session && session.isPaused) ? 'RESUME' : 'BREAK';
        const p = document.getElementById('statusPill');
        p.innerText = active ? (session.isPaused ? 'ON BREAK' : 'WORKING') : 'STANDBY';
        p.style.background = active ? (session.isPaused ? 'var(--warning)' : 'var(--success)') : 'rgba(255,255,255,0.1)';
        if (!active) document.getElementById('display').innerText = "00:00:00";
    }

    function updateView() {
        const list = document.getElementById('logList'); list.innerHTML = '';
        let tH = 0;
        const filt = shifts.filter(s => { const d = new Date(s.st); return d >= new Date(cfg.s) && d <= new Date(cfg.e + 'T23:59:59'); });

        if (filt.length > 0) {
            const l = filt[0]; document.getElementById('quickEdit').style.display = 'block';
            document.getElementById('eStart').value = new Date(l.st).toTimeString().slice(0,5);
            document.getElementById('eEnd').value = new Date(l.en).toTimeString().slice(0,5);
            document.getElementById('eBreak').value = Math.round(l.br / 60000);
        } else { document.getElementById('quickEdit').style.display = 'none'; }

        filt.forEach(s => {
            const h = (new Date(s.en) - new Date(s.st) - s.br) / 3600000;
            tH += h;
            const item = document.createElement('div');
            item.className = 'log-item';
            item.innerHTML = `<div style="display:flex; justify-content:space-between;"><strong>${new Date(s.st).toLocaleDateString('en-GB')}</strong> <span style="color:var(--success); font-weight:800;">£${(h*cfg.rate).toFixed(2)}</span></div><div style="font-size:0.75rem; opacity:0.6; margin-top:4px;">${h.toFixed(2)} hrs | ${Math.round(s.br/60000)}m break</div>`;
            list.appendChild(item);
        });
        document.getElementById('payVal').innerText = `£${(tH * cfg.rate).toFixed(2)}`;
        document.getElementById('hrVal').innerText = tH.toFixed(2);
    }

    function editLast() {
        const l = shifts[0];
        const [sh, sm] = document.getElementById('eStart').value.split(':'), [eh, em] = document.getElementById('eEnd').value.split(':');
        const st = new Date(l.st), en = new Date(l.en);
        st.setHours(sh, sm); en.setHours(eh, em);
        l.st = st.toISOString(); l.en = en.toISOString();
        l.br = document.getElementById('eBreak').value * 60000;
        localStorage.setItem('hb_sh_v19', JSON.stringify(shifts));
        updateView();
    }

    function exportMail() {
        let b = `Timesheet: ${cfg.pName}\nTotal Hours: ${document.getElementById('hrVal').innerText}\nTotal Pay: ${document.getElementById('payVal').innerText}\n\n`;
        shifts.forEach(s => { const h = (new Date(s.en)-new Date(s.st)-s.br)/3600000; b += `${new Date(s.st).toLocaleDateString('en-GB')}: ${h.toFixed(2)} hrs (£${(h*cfg.rate).toFixed(2)})\n`; });
        window.location.href = `mailto:?subject=${encodeURIComponent(cfg.pName)}&body=${encodeURIComponent(b)}`;
    }

    function toggleTheme() { cfg.theme = cfg.theme === 'light' ? 'dark' : 'light'; localStorage.setItem('hb_cf_v19', JSON.stringify(cfg)); location.reload(); }
    function openModal() { document.getElementById('helpModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('helpModal').style.display = 'none'; }
    init();
</script>
</body>
</html>

